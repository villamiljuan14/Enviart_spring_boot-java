<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista de Usuarios</title>

    <!-- Tailwind CSS (CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- DataTables con soporte Tailwind -->
    <link rel="stylesheet" 
          href="https://cdn.datatables.net/2.1.3/css/dataTables.tailwindcss.min.css">
    <!-- jQuery es necesario para DataTables -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.datatables.net/2.1.3/js/dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/2.1.3/js/dataTables.tailwindcss.min.js"></script>
    
    <!-- Configuración personalizada para DataTables -->
    <style>
        /* Asegurar que la tabla ocupe menos espacio en pantallas grandes si tiene muchas columnas */
        #usuariosTable {
            width: 100% !important;
        }
        /* Ajuste de color para la paginación de DataTables con Tailwind */
        .dataTables_wrapper .dataTables_paginate .paginate_button.current {
            background-color: #4f46e5; /* indigo-600 */
            border-color: #4f46e5;
            color: white !important;
        }
    </style>
</head>

<body class="bg-gray-100 text-gray-800">

<div class="max-w-7xl mx-auto mt-10 bg-white p-6 rounded-2xl shadow-xl">
    <div class="flex justify-between items-center mb-6 border-b pb-4">
        <h2 class="text-3xl font-extrabold text-gray-800">Gestión de Usuarios</h2>
        <a th:href="@{/usuarios/nuevo}" 
           class="bg-indigo-600 text-white px-5 py-2 rounded-lg font-semibold shadow-md hover:bg-indigo-700 transition">
            <span class="text-lg">+</span> Nuevo Usuario
        </a>
    </div>

    <!-- Tabla con DataTables -->
    <div class="overflow-x-auto">
        <table id="usuariosTable" class="min-w-full divide-y divide-gray-200 text-sm text-left">
            <thead class="bg-gray-700 text-gray-100 uppercase text-xs tracking-wider">
                <tr>
                    <th class="px-4 py-3 rounded-tl-lg">ID</th>
                    <th class="px-4 py-3">Email</th>
                    <th class="px-4 py-3">1er Nombre</th>
                    <th class="px-4 py-3">2do Nombre</th>
                    <th class="px-4 py-3">1er Apellido</th>
                    <th class="px-4 py-3">2do Apellido</th>
                    <th class="px-4 py-3">Rol</th>
                    <th class="px-4 py-3 rounded-tr-lg text-center">Acciones</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-gray-100">
                <tr th:each="u : ${usuarios}" class="hover:bg-indigo-50/50 transition duration-150">
                    <td class="px-4 py-3 font-mono text-xs" th:text="${u.idUsuario}">1</td>
                    <td class="px-4 py-3 font-medium text-gray-900" th:text="${u.email}">usuario@correo.com</td>
                    <!-- Campos individuales del usuario -->
                    <td class="px-4 py-3" th:text="${u.primerNombre}">Nombre1</td>
                    <td class="px-4 py-3" th:text="${u.segundoNombre}">Nombre2</td>
                    <td class="px-4 py-3" th:text="${u.primerApellido}">Apellido1</td>
                    <td class="px-4 py-3" th:text="${u.segundoApellido}">Apellido2</td>

                    <td class="px-4 py-3">
                        <span th:text="${u.rol.tipoRol}" 
                              th:classappend="${u.rol.tipoRol == 'ADMIN'} ? 'bg-purple-100 text-purple-800' : 'bg-green-100 text-green-800'"
                              class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full">
                            ROL
                        </span>
                    </td>
                    <td class="px-4 py-3 text-center space-x-2 whitespace-nowrap">
                        <a th:href="@{'/usuarios/editar/' + ${u.idUsuario}}" 
                           class="bg-yellow-500 text-white px-3 py-1 rounded-md text-xs hover:bg-yellow-600 transition">Editar</a>
                        
                        <a th:href="@{'/usuarios/eliminar/' + ${u.idUsuario}}" 
                           class="bg-red-600 text-white px-3 py-1 rounded-md text-xs hover:bg-red-700 transition"
                           title="Eliminar usuario">
                            Eliminar
                        </a>
                    </td>
                </tr>

                <tr th:if="${#lists.isEmpty(usuarios)}">
                    <td colspan="8" class="text-center py-8 text-gray-500 font-medium">
                        <svg class="w-6 h-6 inline-block mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M5 12h14"></path></svg>
                        No hay usuarios registrados.
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Enlace para volver a Home y Logout -->
    <div class="flex justify-between mt-8 pt-4 border-t border-gray-200">
        <a th:href="@{/home}" 
           class="text-indigo-600 hover:text-indigo-800 transition font-medium">
            ← Volver al inicio
        </a>
        <form th:action="@{/logout}" method="post">
            <button type="submit" 
                    class="bg-gray-500 text-white px-4 py-2 rounded-lg font-semibold hover:bg-gray-600 transition">
                Cerrar sesión
            </button>
        </form>
    </div>
</div>

<!-- Script para inicializar DataTable -->
<script>
    document.addEventListener("DOMContentLoaded", () => {
        if (document.getElementById('usuariosTable')) {
            // Inicialización de DataTables (requiere jQuery)
            new DataTable('#usuariosTable', {
                responsive: true,
                language: {
                    search: "Buscar:",
                    lengthMenu: "Mostrar _MENU_ registros",
                    info: "Mostrando _START_ a _END_ de _TOTAL_ usuarios",
                    paginate: { previous: "Anterior", next: "Siguiente" },
                    emptyTable: "No hay usuarios disponibles",
                    infoEmpty: "Mostrando 0 de 0 usuarios",
                    infoFiltered: "(filtrado de _MAX_ usuarios totales)"
                },
                // Deshabilitar ordenamiento en la columna de Acciones (índice 7)
                columnDefs: [
                    { targets: 7, orderable: false } 
                ]
            });
        }
    });
</script>

</body>
</html>