<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulario de Usuario</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>

<body class="bg-gray-50 min-h-screen flex items-center justify-center p-4">

<div class="bg-white shadow-2xl rounded-xl w-full max-w-2xl p-10 transform transition duration-500 hover:shadow-3xl">
    <h2 class="text-3xl font-extrabold text-center text-green-700 mb-8 border-b pb-4">
        <span th:text="${usuario.idUsuario == null ? 'Crear Nuevo Usuario' : 'Editar Usuario'}"></span>
    </h2>

    <form th:action="@{${accion}}" th:object="${usuario}" method="post" class="grid grid-cols-1 md:grid-cols-2 gap-6">
        
        <!-- 1. IDENTIFICADOR (Oculto) -->
        <div class="col-span-full">
            <input type="hidden" th:field="*{idUsuario}" /> 
        </div>

        <!-- 2. Tipo de Documento -->
        <div>
            <label for="tipoDocumento" class="block text-gray-700 font-semibold mb-1">
                Tipo Documento
            </label>
            <select id="tipoDocumento" th:field="*{tipoDocumento}" required
                    class="w-full border border-gray-300 rounded-lg px-4 py-2 bg-white focus:outline-none focus:ring-2 focus:ring-green-500 transition duration-150">
                <option value="" disabled>Selecciona tipo</option>
                <!-- Aquí puedes añadir más tipos de documento según sea necesario -->
                <option value="CC">Cédula de Ciudadanía (CC)</option>
                <option value="TI">Tarjeta de Identidad (TI)</option>
                <option value="CE">Cédula de Extranjería (CE)</option>
                <option value="PAS">Pasaporte (PAS)</option>
            </select>
        </div>
        
        <!-- 3. Número de Documento (docUsuario) -->
        <div>
            <label for="docUsuario" class="block text-gray-700 font-semibold mb-1">
                Número de Documento
            </label>
            <input type="text" id="docUsuario" th:field="*{docUsuario}" required
                   class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-green-500 transition duration-150" />
        </div>

        <!-- 4. Primer Nombre -->
        <div>
            <label for="primerNombre" class="block text-gray-700 font-semibold mb-1">
                Primer Nombre
            </label>
            <input type="text" id="primerNombre" th:field="*{primerNombre}" required
                   class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-green-500 transition duration-150" />
        </div>

        <!-- 5. Segundo Nombre (Opcional) -->
        <div>
            <label for="segundoNombre" class="block text-gray-700 font-semibold mb-1">
                Segundo Nombre (Opcional)
            </label>
            <input type="text" id="segundoNombre" th:field="*{segundoNombre}"
                   class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-green-500 transition duration-150" />
        </div>
        
        <!-- 6. Primer Apellido -->
        <div>
            <label for="primerApellido" class="block text-gray-700 font-semibold mb-1">
                Primer Apellido
            </label>
            <input type="text" id="primerApellido" th:field="*{primerApellido}" required
                   class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-green-500 transition duration-150" />
        </div>

        <!-- 7. Segundo Apellido (Opcional) -->
        <div>
            <label for="segundoApellido" class="block text-gray-700 font-semibold mb-1">
                Segundo Apellido (Opcional)
            </label>
            <input type="text" id="segundoApellido" th:field="*{segundoApellido}"
                   class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-green-500 transition duration-150" />
        </div>

        <!-- 8. Teléfono -->
        <div>
            <label for="telefono" class="block text-gray-700 font-semibold mb-1">
                Teléfono
            </label>
            <input type="tel" id="telefono" th:field="*{telefono}"
                   class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-green-500 transition duration-150" />
        </div>

        <!-- 9. Correo electrónico (Email) -->
        <div>
            <label for="email" class="block text-gray-700 font-semibold mb-1">
                Correo electrónico
            </label>
            <input type="email" id="email" th:field="*{email}" required
                   class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-green-500 transition duration-150" />
        </div>

        <!-- 10. Contraseña (password) -->
        <div>
            <label for="password" class="block text-gray-700 font-semibold mb-1">
                Contraseña
            </label>
            <!-- La contraseña es requerida solo al crear (idUsuario es nulo) -->
            <input type="password" id="password" th:field="*{password}" 
                   th:required="${usuario.idUsuario == null}"
                   class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-green-500 transition duration-150" 
                   placeholder="Solo requerido al crear. Dejar en blanco para no cambiar."/>
        </div>

        <!-- 11. Estado del Usuario (estadoUsuario) -->
        <div>
            <label for="estadoUsuario" class="block text-gray-700 font-semibold mb-1">
                Estado
            </label>
            <select id="estadoUsuario" th:field="*{estadoUsuario}" required
                    class="w-full border border-gray-300 rounded-lg px-4 py-2 bg-white focus:outline-none focus:ring-2 focus:ring-green-500 transition duration-150">
                <option value="true">Activo</option>
                <option value="false">Inactivo</option>
            </select>
        </div>

        <!-- 12. Rol (rol) - Requiere manejo especial para objetos ManyToOne -->
        <!-- Se asume que el controlador proporciona una lista de Roles llamada 'roles' -->
        <div sec:authorize="hasRole('ADMIN')">
            <label for="rol" class="block text-gray-700 font-semibold mb-1">
                Rol
            </label>
            <!-- 
                IMPORTANTE: Como 'rol' es un objeto (ManyToOne), Thymeaf necesita saber qué propiedad usar para el valor.
                Aquí usamos 'rol.idRol' asumiendo que tu clase Rol tiene un campo 'idRol'.
                Si no tienes una lista de roles, el controlador debe enviarla (ej: model.addAttribute("listaRoles", roles)).
            -->
            <select id="rol" th:field="*{rol}"
                    class="w-full border border-gray-300 rounded-lg px-4 py-2 bg-white focus:outline-none focus:ring-2 focus:ring-green-500 transition duration-150">
                <!-- Se asume que tienes una lista llamada 'listaRoles' en el modelo -->
                <option th:each="r : ${listaRoles}" 
                        th:value="${r.idRol}" 
                        th:text="${r.nombreRol}">
                    Rol Ejemplo
                </option>
            </select>
        </div>
        
        <!-- Botones de acción -->
        <div class="col-span-full flex justify-between pt-8 border-t mt-6">
            <a th:href="@{/usuarios}"
               class="bg-gray-400 text-white px-8 py-3 rounded-lg font-bold hover:bg-gray-500 transition duration-150 shadow-md">
                Cancelar
            </a>
            <button type="submit"
                    class="bg-green-600 text-white px-8 py-3 rounded-lg font-bold hover:bg-green-700 transition duration-150 shadow-xl">
                <span th:text="${usuario.idUsuario == null ? 'Registrar Usuario' : 'Confirmar Cambios'}"></span>
            </button>
        </div>
    </form>
</div>

</body>
</html>